<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blogging App</title>
    <link rel="stylesheet" href="assests/css/login_signup.css">
    <link rel="stylesheet" href="assests/css/main.css">
    <link rel="stylesheet" href="assests/css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<body>
    
    <header>
        <!-- navbar start -->
        <nav class="navbar container-fluid">
            <a href="index.html"><h4>Blogging App</h4></a>
            <!-- <div>
                <a class="login_signup" href="signup.html">Signup</a>
                <a class="login_signup" id="logout">Logout</a>
            </div> -->
        </nav>
          <!-- navbar end -->
        <div class="container-fluid page-title">
            <h1>Login</h1>
        </div>
    </header>

    <section class="box">
        <form id="mainForm">
            <input type="email" id="emailInput" placeholder="Email" autocomplete="off" required>
            <input type="password" id="passwordInput" placeholder="Password" minlength="8" required>
            <i class="fa-solid fa-eye-slash" id="showPass"></i>

            <button type="submit" id="login">Login</button>
            <a href="signup.html">Don't have an account?</a>
        </form>
    </section>

    
    <script src="./assests/js/main.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import {
          getFirestore, doc, getDoc
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import {
          getAuth,
          signInWithEmailAndPassword,
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  
        const firebaseConfig = {
            apiKey: "AIzaSyDjWgkEDZI6dPWbai_OJ6KLKI9A8l83m4I",
            authDomain: "blogapp-c7488.firebaseapp.com",
            projectId: "blogapp-c7488",
            storageBucket: "blogapp-c7488.appspot.com",
            messagingSenderId: "889483622671",
            appId: "1:889483622671:web:8eef199be7330f2418667a",
        };
  
        const app = initializeApp(firebaseConfig);
        const db = getFirestore();
        const auth = getAuth(app);
  
        const email = document.getElementById("emailInput");
        const password = document.getElementById("passwordInput");
        const mainForm = document.getElementById("mainForm");
        const resetPass = document.getElementById("resetPass");
  
        let login = (eve) => {
          eve.preventDefault();
  
          signInWithEmailAndPassword(auth, email.value, password.value)
            .then(async (userCredential) => {
              var ref = doc(db, "Users", userCredential.user.uid);
              const docSnap = await getDoc(ref)
              if(docSnap.exists()){
                 localStorage.setItem("user-info", JSON.stringify({
                  firstName: docSnap.data().firstName,
                  lastName: docSnap.data().lastName
                 }))
                 localStorage.setItem("user-creds", JSON.stringify(userCredential));
                 window.location.href = "index.html";
              }
  
              swal("Login Successful!" , "", "success");
              // console.log(userCredential);
              email.value = "";
              password.value = "";
              window.location.href = "dashboard.html";
            })
            .catch((e) => {
              if(e.code === "auth/invalid-email"){
                  swal("Email is missing!" , "", "error");
              }else if(e.code === "auth/missing-password"){
                  swal("Password is missing!" , "", "error");
              }else if(e.code === "auth/too-many-requests"){
                  swal("Account temporarily disabled due to multiple failed login attempts. Reset password or try again later." , "", "error");
                  resetPass.style.display = "block"
              }else{
                  swal("Invalid Credentials!" , "", "error");
              }
            //   console.log(e.code);
              // console.log(e.message);
            });
        };
  
        mainForm.addEventListener("submit", login);
      </script>

    <!-- sweet alert library-->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

</body>
</html>